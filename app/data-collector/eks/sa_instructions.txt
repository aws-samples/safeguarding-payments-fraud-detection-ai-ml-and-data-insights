1. cat >s3-policy.json <<EOF
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Effect": "Allow",
			"Action": "s3:*",
			"Resource": "*"
		},
		{
			"Effect": "Allow",
			"Action": "ssm:*",
			"Resource": "*"
		},
		{
			"Effect": "Allow",
			"Action": "dynamodb:*",
			"Resource": "arn:aws:dynamodb:us-east-1:886958290065:table/rp2-transaction-c7a71b68"
		}
	]
}
EOF

2. aws iam create-policy --policy-name payment-fraud-eks-s3-policy --policy-document file://s3-policy.json

3. eksctl create iamserviceaccount --name payment-fraud-service-account --namespace payment-fraud-detect-app --cluster private-public-ingress --role-name payment-fraud-app-role \
    --attach-policy-arn arn:aws:iam::886958290065:policy/payment-fraud-eks-s3-policy --approve --region us-east-1

4. aws iam get-role --role-name payment-fraud-app-role --query Role.AssumeRolePolicyDocument

5. aws iam list-attached-role-policies --role-name payment-fraud-app-role --query AttachedPolicies[].PolicyArn --output text

6. export policy_arn=arn:aws:iam::886958290065:policy/payment-fraud-eks-s3-policy




REQUEST:
eksctl create iamserviceaccount \
  --override-existing-serviceaccounts \
  --approve --region us-east-1 \
  --cluster $cluster_name \
  --name spf-service-account \
  --namespace spf-app-data-collector-us-east-1-c12a0914 \
  --attach-policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess \
  --attach-policy-arn arn:aws:iam::aws:policy/AmazonSSMFullAccess \
  --attach-policy-arn arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess
RESPONSE:
2024-05-15 13:11:17 [ℹ]  1 iamserviceaccount (spf-app-data-collector-us-east-1-c12a0914/spf-service-account) was included (based on the include/exclude rules)
2024-05-15 13:11:17 [!]  metadata of serviceaccounts that exist in Kubernetes will be updated, as --override-existing-serviceaccounts was set
2024-05-15 13:11:17 [ℹ]  1 task: {
    2 sequential sub-tasks: {
        create IAM role for serviceaccount "spf-app-data-collector-us-east-1-c12a0914/spf-service-account",
        create serviceaccount "spf-app-data-collector-us-east-1-c12a0914/spf-service-account",
    } }2024-05-15 13:11:17 [ℹ]  building iamserviceaccount stack "eksctl-spf-eks-cluster-us-east-1-c12a0914-addon-iamserviceaccount-spf-app-data-collector-us-east-1-c12a0914-spf-service-account"
2024-05-15 13:11:17 [ℹ]  deploying stack "eksctl-spf-eks-cluster-us-east-1-c12a0914-addon-iamserviceaccount-spf-app-data-collector-us-east-1-c12a0914-spf-service-account"
2024-05-15 13:11:17 [ℹ]  waiting for CloudFormation stack "eksctl-spf-eks-cluster-us-east-1-c12a0914-addon-iamserviceaccount-spf-app-data-collector-us-east-1-c12a0914-spf-service-account"
2024-05-15 13:11:47 [ℹ]  waiting for CloudFormation stack "eksctl-spf-eks-cluster-us-east-1-c12a0914-addon-iamserviceaccount-spf-app-data-collector-us-east-1-c12a0914-spf-service-account"
2024-05-15 13:11:48 [ℹ]  created namespace "spf-app-data-collector-us-east-1-c12a0914"
2024-05-15 13:11:48 [ℹ]  created serviceaccount "spf-app-data-collector-us-east-1-c12a0914/spf-service-account"
